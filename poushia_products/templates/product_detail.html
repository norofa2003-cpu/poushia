{% extends 'base/base.html' %}
{% load static %}
{% load render_partial %}
{% block contents %}
<div class="container">
    <!-- Breadcrumb -->
    <ul class="breadcrumb">
        <li><a href="{% url 'home' %}"><i class="fa fa-home"></i></a></li>
        <li><a href="#">{{ product.title }}</a></li>
    </ul>

    <div class="row">
        <!-- Product Detail -->
        <div id="content" class="col-sm-9">
            <div itemscope itemtype="http://schema.org/Product">
                <h1 class="title" itemprop="name">{{ product.title }}</h1>

                <div class="row product-info">
                    <!-- Product Image -->
                    <div class="col-sm-6">
                        <div class="image">
                            <img class="img-responsive" itemprop="image" src="{{ product.image.url }}"
                                 alt="{{ product.title }}" style="max-width:300px;">
                        </div>
                        <div class="image-additional" id="gallery_01">
                            {% for image_gallery in gallery %}
                            <a class="thumbnail" href="#" data-image="{{ image_gallery.image.url }}">
                                <img src="{{ image_gallery.image.url }}" alt="{{ image_gallery.title }}">
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Product Info -->
                    <div class="col-sm-6">
                        <ul class="list-unstyled description">
                            <li><b>برند:</b> {{ product.brand }}</li>
                            <li><b>کد محصول:</b> {{ product.id }}</li>
                            <li><b>امتیاز:</b> {{ product.rating }}</li>
                            <li><b>وضعیت:</b>
                                {% if product.stock > 0 %}
                                <span class="instock">موجود</span>
                                {% else %}
                                <span class="outstock">ناموجود</span>
                                {% endif %}
                            </li>
                        </ul>

                        <ul class="price-box">
                            <li class="price"><span>{{ product.price }} </span></li>
                        </ul>

                        <!-- Add to Cart -->
                        <form action="/add-new-order" method="post" class="mt-4">
                            {% csrf_token %}
                            <div class="form-group">
                                <label>رنگ</label>
                                <select name="color" class="form-control">
                                    <option value="">انتخاب کنید</option>
                                    {% for color in product.colors.all %}
                                    <option value="{{ color.id }}">{{ color.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="form-group">
                                <label>سایز</label>
                                <select name="size" class="form-control">
                                    <option value="">انتخاب کنید</option>
                                    {% for size in product.sizes.all %}
                                    <option value="{{ size.id }}">{{ size.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="form-group d-flex align-items-center gap-2">
                                <label for="count" class="mb-0">تعداد:</label>
                                {{ new_order_form.count }}
                                {{ new_order_form.product_id }}
                            </div>

                            <button type="submit" class="btn btn-success btn-lg mt-3">🛒 افزودن به سبد خرید</button>
                        </form>
<!-- Wishlist & Styleboard -->
                        <div class="mt-3 d-flex gap-2">
                            <form method="post" action="{% url 'wishlist:add' product.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-danger btn-sm" title="علاقه‌مندی">❤️</button>
                            </form>

                            <form method="post" action="{% url 'styleboard:add' product.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-warning btn-sm" title="استایل‌ساز">✨</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <ul class="nav nav-tabs mt-4">
                    <li class="active"><a href="#tab-description" data-toggle="tab">توضیحات</a></li>
                </ul>
                <div class="tab-content border p-3">
                    <div id="tab-description" class="tab-pane active">
                        {{ product.description|safe }}
                    </div>
                </div>

                <!-- Related Products -->
                <h3 class="subtitle mt-5 mb-3">محصولات مرتبط</h3>
                <div class="owl-carousel related_pro">
                    {% for related in related_products %}
                    <div class="product-thumb text-center p-3 shadow-sm border rounded" style="width: 220px;">
                        <a href="{{ related.getproductdetail_url }}">
                            <img src="{{ related.image.url }}" alt="{{ related.title }}" class="img-fluid" style="height: 180px; object-fit: cover; border-radius: 8px;">
                        </a>
                        <h5 class="mt-2">{{ related.title }}</h5>
                        <p class="price text-muted">{{ related.price }}</p>

                        <div class="mt-2 d-flex justify-content-center gap-2">
                            <a href="{{ related.getproductdetail_url }}" class="btn btn-light btn-sm" title="مشاهده محصول">👁️</a>

                            {% if request.user.is_authenticated %}
                            <form method="post" action="{% url 'wishlist:add' related.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-danger btn-sm" title="علاقه‌مندی">❤️</button>
                            </form>

                            <form method="post" action="{% url 'styleboard:add' related.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-warning btn-sm" title="استایل‌ساز">✨</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}